<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Memory Match — Fly Express</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --glass: rgba(255,255,255,.06);
    --card: rgba(255,255,255,.08);
    --muted:#b8c0c9;
    --ok:#00ffaa;
    --warn:#ffd166;
    --bad:#ff4d7a;
    --title:#60e9ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:'Cairo',system-ui,sans-serif; color:#eaf1f6;
    min-height:100svh; display:flex; align-items:center; justify-content:center; padding:22px;
    background:
      radial-gradient(1100px 600px at 10% 10%, #071b2a 0%, transparent 65%),
      radial-gradient(1100px 600px at 90% 90%, #00131c 0%, transparent 65%),
      conic-gradient(from 0deg at 50% 50%, #021018, #0b2b44, #032235, #021018);
    background-size:140% 140%,140% 140%,200% 200%;
    animation: bg1 16s ease-in-out infinite, hue 32s linear infinite;
  }
  @keyframes bg1{0%,100%{background-position:10% 10%,90% 90%,0% 50%}50%{background-position:30% 20%,70% 80%,100% 50%}}
  @keyframes hue{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}

  .frame{
    width:100%; max-width:860px; border-radius:24px; padding:22px;
    background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
    box-shadow:0 18px 50px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.05);
  }
  h1{margin:0 0 10px; font-size:34px; font-weight:900; color:#fff; text-align:center}
  h1 .brand{color:var(--title)}
  .sub{margin:6px auto 18px; text-align:center; color:#cfe2ee}

  .stats{display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap}
  .stat{
    flex:1 1 160px; background:var(--glass); border:1px solid rgba(255,255,255,.08);
    padding:12px 14px; border-radius:16px; text-align:center; box-shadow:0 10px 24px rgba(0,0,0,.25);
  }
  .stat .v{font-size:22px; font-weight:900}
  .stat .k{font-size:13px; color:var(--muted)}
  .actions{display:flex; gap:12px; justify-content:center; margin:14px 0 4px}
  .btn{
    background:linear-gradient(90deg,#00ffaa,#7cc6ff); color:#001316; font-weight:900;
    padding:10px 18px; border:none; border-radius:999px; cursor:pointer;
    box-shadow:0 10px 28px rgba(0,255,170,.25); transition:transform .1s ease; font-size:16px;
  }
  .btn.secondary{background:linear-gradient(90deg,#d3f3ff,#b4ffd0); color:#003b35}
  .btn:active{transform:translateY(1px)}

  /* اللوح */
  .board{margin-top:14px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.07);
    border-radius:18px; padding:16px;}
  .grid{display:grid; gap:12px; justify-items:center}
  /* 4x4 على الموبايل، 5x4 على الشاشات الواسعة عند الصعب */
  .grid.cols4{grid-template-columns:repeat(4,1fr)}
  .grid.cols5{grid-template-columns:repeat(5,1fr)}

  .card{
    width:100%; max-width:120px; aspect-ratio:1/1.2; border-radius:16px; position:relative;
    perspective:900px; cursor:pointer;
  }
  .face{
    position:absolute; inset:0; display:grid; place-items:center; font-size:46px; font-weight:900;
    border-radius:16px; border:1px solid rgba(255,255,255,.12);
    backface-visibility:hidden; transition: transform .4s ease;
    box-shadow:0 12px 26px rgba(0,0,0,.35);
  }
  .front{ background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.35)); transform:rotateY(0deg)}
  .back{ background:linear-gradient(180deg, #5eead4, #22d3ee); color:#002; transform:rotateY(180deg)}
  .card.flipped .front{ transform:rotateY(180deg)}
  .card.flipped .back{ transform:rotateY(0deg)}
  .card.matched{ filter:saturate(1.2) drop-shadow(0 0 10px rgba(0,255,170,.35))}

  .result{margin:12px 0 4px; text-align:center; font-weight:900}
  .result.win{color:var(--ok)} .result.lose{color:var(--bad)}

  /* طبقة البداية */
  #overlay{
    position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); backdrop-filter: blur(3px); z-index:30;
  }
  .startBox{
    background:rgba(10,20,28,.95); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:22px; text-align:center;
    box-shadow:0 24px 50px rgba(0,0,0,.45); width:min(460px,92vw);
  }
  .opts{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:10px 0}
  .chip{padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.15); cursor:pointer}
  .chip.active{background:#5eead4; color:#003; font-weight:900}
  .note{color:var(--muted); text-align:center; font-weight:700; margin-top:6px}
  @media (max-width:520px){
    .face{font-size:38px}
  }
</style>
</head>
<body>

<div class="frame">
  <h1><span class="brand">Fly Express</span> — Memory Match</h1>
  <div class="sub">طابق الكروت المتشابهة قبل ما الوقت يخلص! كل تطابق +100، خطأ −10. </div>

  <div class="stats">
    <div class="stat"><div class="v" id="time">60</div><div class="k">الوقت (ث)</div></div>
    <div class="stat"><div class="v" id="score">0</div><div class="k">النقاط</div></div>
    <div class="stat"><div class="v" id="moves">0</div><div class="k">المحاولات</div></div>
    <div class="stat"><div class="v" id="best">0</div><div class="k">أعلى نتيجة</div></div>
    <div class="stat" style="flex:1 1 220px"><button class="btn" id="startBtn">ابدأ 🎯</button></div>
  </div>

  <div class="board">
    <div id="grid" class="grid cols4"></div>
    <div id="final" class="result"></div>
    <div class="actions">
      <button class="btn secondary" id="infoBtn">إزاي ألعب؟</button>
      <button class="btn" id="restartBtn" style="display:none">إعادة 🔁</button>
    </div>
  </div>
  <div class="note">نصيحة: راقب أماكن الإيموجيز بسرعة، كل ما تغلط أقل — نقاطك أعلى!</div>
</div>

<!-- شاشة اختيار الصعوبة -->
<div id="overlay">
  <div class="startBox">
    <div style="font-weight:900;font-size:22px;margin-bottom:6px">اختر مستوى الصعوبة</div>
    <div class="opts">
      <div class="chip active" data-pairs="6"  data-time="50">سهل (6 أزواج)</div>
      <div class="chip"        data-pairs="8"  data-time="60">متوسط (8 أزواج)</div>
      <div class="chip"        data-pairs="10" data-time="75">صعب (10 أزواج)</div>
    </div>
    <button class="btn" id="goBtn">ابدأ اللعبة 🚀</button>
    <div class="note">هتتسجل أعلى نتيجة على جهازك تلقائيًا.</div>
  </div>
</div>

<script>
/* ===== بيانات أساسية ===== */
const EMOJIS = ["🌸","💖","🧁","🦋","🍓","🌈","🐱","⭐","🍉","🎀","🧸","☕","🍒","🐼","🌼","📦","💐","🍩"];
const POINT_MATCH = 100, POINT_WRONG = -10;
let pairsCount = 6, timeTotal = 50;

/* ===== عناصر DOM ===== */
const gridEl   = document.querySelector('#grid');
const scoreEl  = document.querySelector('#score');
const movesEl  = document.querySelector('#moves');
const timeEl   = document.querySelector('#time');
const bestEl   = document.querySelector('#best');
const finalEl  = document.querySelector('#final');
const startBtn = document.querySelector('#startBtn');
const restartBtn = document.querySelector('#restartBtn');
const infoBtn  = document.querySelector('#infoBtn');
const overlay  = document.querySelector('#overlay');
const goBtn    = document.querySelector('#goBtn');
const chips    = [...document.querySelectorAll('.chip')];

let best = parseInt(localStorage.getItem('mm_best')||'0'); bestEl.textContent = best;

/* ===== صوتيات خفيفة (بعد أول تفاعل) ===== */
let ctx, AC, outGain;
function audioInit(){ if(ctx) return; AC = window.AudioContext||window.webkitAudioContext; if(!AC) return;
  ctx = new AC(); outGain = ctx.createGain(); outGain.gain.value=.15; outGain.connect(ctx.destination);
}
function beep(f=800,d=.08,t="triangle"){ if(!ctx) return;
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.type=t; o.frequency.value=f; o.connect(g); g.connect(outGain);
  const s=ctx.currentTime; g.gain.setValueAtTime(.0001,s);
  g.gain.exponentialRampToValueAtTime(.6,s+.01);
  g.gain.exponentialRampToValueAtTime(.0001,s+d);
  o.start(s); o.stop(s+d+.01);
}
["pointerdown","touchstart","click"].forEach(e=>addEventListener(e,audioInit,{once:true}));

/* ===== حالة اللعبة ===== */
let deck=[], first=null, second=null, lock=false;
let score=0, moves=0, timeLeft=0, timer=null, matched=0;

/* ===== أدوات ===== */
const shuffle = a => a.sort(()=>Math.random()-0.5);

/* إنشاء الدك حسب عدد الأزواج */
function buildDeck(){
  const chosen = shuffle([...EMOJIS]).slice(0, pairsCount);
  deck = shuffle([...chosen, ...chosen]).map((sym,i)=>({id:i, sym, matched:false}));
  // الأعمدة: 4 للغالبية، ولو 10 أزواج نخليه 5
  gridEl.classList.toggle('cols5', pairsCount>=10);
  gridEl.classList.toggle('cols4', pairsCount<10);
}

/* رسم الكروت */
function render(){
  gridEl.innerHTML='';
  deck.forEach(card=>{
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.id = card.id;
    el.innerHTML = `
      <div class="face front">?</div>
      <div class="face back">${card.sym}</div>
    `;
    gridEl.appendChild(el);
  });
}

/* قلب كارت */
function flipCard(el){
  if(lock) return;
  const id = +el.dataset.id;
  const card = deck.find(c=>c.id===id);
  if(!card || card.matched) return;

  el.classList.add('flipped'); beep(700,.06,"square");

  if(!first){
    first = {el, card};
  }else if(el!==first.el){
    second = {el, card};
    lock = true; moves++; movesEl.textContent=moves;

    if(first.card.sym === second.card.sym){
      // ماتش
      first.card.matched = second.card.matched = true;
      first.el.classList.add('matched'); second.el.classList.add('matched');
      score += POINT_MATCH; scoreEl.textContent=score; matched++;
      beep(980,.09,"sine");
      [first,second]=[null,null]; lock=false;
      if(matched === pairsCount) endGame(true);
    }else{
      // خطأ
      score = Math.max(0, score + POINT_WRONG); scoreEl.textContent=score;
      setTimeout(()=>{
        first.el.classList.remove('flipped');
        second.el.classList.remove('flipped');
        [first,second]=[null,null]; lock=false;
      }, 650);
    }
  }
}

/* بدء */
function startGame(){
  score=0; moves=0; matched=0; timeLeft=timeTotal;
  scoreEl.textContent=0; movesEl.textContent=0; timeEl.textContent=timeLeft;
  finalEl.textContent=''; finalEl.className='result';
  restartBtn.style.display='none';

  buildDeck(); render();

  // ربط الكروت
  gridEl.querySelectorAll('.card').forEach(el=>{
    el.addEventListener('click', ()=> flipCard(el));
  });

  clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--; timeEl.textContent=timeLeft;
    if(timeLeft<=0) endGame(false);
  }, 1000);
}

/* نهاية */
function endGame(win){
  clearInterval(timer);
  restartBtn.style.display='inline-block';
  if(win){
    best = Math.max(best, score);
    localStorage.setItem('mm_best', best); bestEl.textContent=best;
    finalEl.textContent = `🎉 مبروك! خلّصت كله — نتيجتك: ${score}`;
    finalEl.classList.add('win'); beep(660,.12,"sine"); setTimeout(()=>beep(990,.14,"sine"),120);
  }else{
    finalEl.textContent = `انتهى الوقت — نتيجتك: ${score} 🙈`;
    finalEl.classList.add('lose'); beep(180,.14,"sawtooth");
  }
}

/* واجهة */
startBtn.addEventListener('click', ()=>{
  overlay.style.display='grid';
});
restartBtn.addEventListener('click', startGame);
goBtn.addEventListener('click', ()=>{
  overlay.style.display='none';
  startGame();
});
chips.forEach(ch=>{
  ch.addEventListener('click', ()=>{
    chips.forEach(x=>x.classList.remove('active'));
    ch.classList.add('active');
    pairsCount = +ch.dataset.pairs;
    timeTotal  = +ch.dataset.time;
  });
});
infoBtn.addEventListener('click', ()=>{
  alert('اقلب بطاقتين في كل مرة وحاول تفتكر أماكنهم. التطابق +100، الخطأ -10. اختَر الصعوبة وحقق أعلى نتيجة!');
});
</script>
</body>
</html>
